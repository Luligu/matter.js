{
  "version": 3,
  "sources": ["../../../src/util/progress.ts"],
  "sourcesContent": ["/**\n * @license\n * Copyright 2022-2023 Project CHIP Authors\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport colors from \"ansi-colors\";\nimport { stdout } from \"process\";\nimport { Package } from \"./package.js\";\n\n// eslint-disable-next-line @typescript-eslint/unbound-method\nconst actualWrite = process.stdout.write;\n\nconst FRONT = \"\\x1b[G\";\nconst CLEAR = \"\\x1b[K\";\n\nfunction packageIdentity(pkg: Package) {\n    return `${colors.bold(pkg.json.name)}@${pkg.json.version}`;\n}\n\nexport class Progress {\n    status = Progress.Status.Startup;\n    private start?: number;\n    private lastLine?: string;\n\n    constructor() {}\n\n    skip(why: string, pkg: Package) {\n        this.write(colors.dim(`Skip ${packageIdentity(pkg)}: ${why}\\n\\n`));\n    }\n\n    startup(what: string, pkg: Package) {\n        this.status = Progress.Status.Startup;\n        this.write(`${what} ${packageIdentity(pkg)}\\n`);\n    }\n\n    update(text: string, extra?: string) {\n        this.status = Progress.Status.Ongoing;\n        let duration;\n        if (this.start === undefined) {\n            this.start = new Date().getTime();\n            duration = \"\";\n        } else {\n            duration = this.duration;\n        }\n        extra = extra === undefined ? \"\" : ` ${extra}`;\n        this.write(`${CLEAR}  ${colors.yellow(\"\u29D7\")} ${text} ${duration}${extra}${FRONT}`);\n        stdout.write(\"\\r\");\n    }\n\n    success(text: string) {\n        this.status = Progress.Status.Success;\n        this.write(`${CLEAR}  ${colors.green(\"\u2714\")} ${text} ${this.duration}\\n`);\n        delete this.start;\n    }\n\n    failure(text: string) {\n        this.status = Progress.Status.Failure;\n        this.write(`${CLEAR}  ${colors.redBright(\"\u2717\")} ${text} ${this.duration}\\n`);\n        delete this.start;\n    }\n\n    info(label: string, value?: any) {\n        if (value) {\n            label = `${colors.dim(label)} ${value}`;\n        }\n        this.write(`${CLEAR}  ${colors.dim(\"\u2023\")} ${label}\\n`);\n    }\n\n    shutdown() {\n        stdout.write(\"\\n\");\n    }\n\n    async run(what: string, fn: () => Promise<void>) {\n        this.update(what);\n        await fn();\n        this.success(what);\n    }\n\n    protected write(text: string) {\n        if (this.lastLine === text) {\n            return;\n        }\n        actualWrite.call(process.stdout, (this.lastLine = text));\n    }\n\n    private get duration() {\n        let ms = this.start ? new Date().getTime() - this.start : 0;\n        if (ms < 1000) {\n            ms = Math.round(ms / 10) / 100;\n        } else if (ms < 10000) {\n            ms = Math.round(ms / 100) / 10;\n        } else {\n            ms = Math.trunc(ms / 1000);\n        }\n        return colors.dim.yellow(`(${ms}s)`);\n    }\n}\n\nexport namespace Progress {\n    export enum Status {\n        Startup = \"startup\",\n        Ongoing = \"ongoing\",\n        Success = \"success\",\n        Failure = \"failure\",\n    }\n}\n"],
  "mappings": "AAAA;AAAA;AAAA;AAAA;AAAA;AAMA,OAAO,YAAY;AACnB,SAAS,cAAc;AAIvB,MAAM,cAAc,QAAQ,OAAO;AAEnC,MAAM,QAAQ;AACd,MAAM,QAAQ;AAEd,SAAS,gBAAgB,KAAc;AACnC,SAAO,GAAG,OAAO,KAAK,IAAI,KAAK,IAAI,CAAC,IAAI,IAAI,KAAK,OAAO;AAC5D;AAEO,MAAM,SAAS;AAAA,EAKlB,cAAc;AAJd,kBAAS,SAAS,OAAO;AAAA,EAIV;AAAA,EAEf,KAAK,KAAa,KAAc;AAC5B,SAAK,MAAM,OAAO,IAAI,QAAQ,gBAAgB,GAAG,CAAC,KAAK,GAAG;AAAA;AAAA,CAAM,CAAC;AAAA,EACrE;AAAA,EAEA,QAAQ,MAAc,KAAc;AAChC,SAAK,SAAS,SAAS,OAAO;AAC9B,SAAK,MAAM,GAAG,IAAI,IAAI,gBAAgB,GAAG,CAAC;AAAA,CAAI;AAAA,EAClD;AAAA,EAEA,OAAO,MAAc,OAAgB;AACjC,SAAK,SAAS,SAAS,OAAO;AAC9B,QAAI;AACJ,QAAI,KAAK,UAAU,QAAW;AAC1B,WAAK,SAAQ,oBAAI,KAAK,GAAE,QAAQ;AAChC,iBAAW;AAAA,IACf,OAAO;AACH,iBAAW,KAAK;AAAA,IACpB;AACA,YAAQ,UAAU,SAAY,KAAK,IAAI,KAAK;AAC5C,SAAK,MAAM,GAAG,KAAK,KAAK,OAAO,OAAO,QAAG,CAAC,IAAI,IAAI,IAAI,QAAQ,GAAG,KAAK,GAAG,KAAK,EAAE;AAChF,WAAO,MAAM,IAAI;AAAA,EACrB;AAAA,EAEA,QAAQ,MAAc;AAClB,SAAK,SAAS,SAAS,OAAO;AAC9B,SAAK,MAAM,GAAG,KAAK,KAAK,OAAO,MAAM,QAAG,CAAC,IAAI,IAAI,IAAI,KAAK,QAAQ;AAAA,CAAI;AACtE,WAAO,KAAK;AAAA,EAChB;AAAA,EAEA,QAAQ,MAAc;AAClB,SAAK,SAAS,SAAS,OAAO;AAC9B,SAAK,MAAM,GAAG,KAAK,KAAK,OAAO,UAAU,QAAG,CAAC,IAAI,IAAI,IAAI,KAAK,QAAQ;AAAA,CAAI;AAC1E,WAAO,KAAK;AAAA,EAChB;AAAA,EAEA,KAAK,OAAe,OAAa;AAC7B,QAAI,OAAO;AACP,cAAQ,GAAG,OAAO,IAAI,KAAK,CAAC,IAAI,KAAK;AAAA,IACzC;AACA,SAAK,MAAM,GAAG,KAAK,KAAK,OAAO,IAAI,QAAG,CAAC,IAAI,KAAK;AAAA,CAAI;AAAA,EACxD;AAAA,EAEA,WAAW;AACP,WAAO,MAAM,IAAI;AAAA,EACrB;AAAA,EAEA,MAAM,IAAI,MAAc,IAAyB;AAC7C,SAAK,OAAO,IAAI;AAChB,UAAM,GAAG;AACT,SAAK,QAAQ,IAAI;AAAA,EACrB;AAAA,EAEU,MAAM,MAAc;AAC1B,QAAI,KAAK,aAAa,MAAM;AACxB;AAAA,IACJ;AACA,gBAAY,KAAK,QAAQ,QAAS,KAAK,WAAW,IAAK;AAAA,EAC3D;AAAA,EAEA,IAAY,WAAW;AACnB,QAAI,KAAK,KAAK,SAAQ,oBAAI,KAAK,GAAE,QAAQ,IAAI,KAAK,QAAQ;AAC1D,QAAI,KAAK,KAAM;AACX,WAAK,KAAK,MAAM,KAAK,EAAE,IAAI;AAAA,IAC/B,WAAW,KAAK,KAAO;AACnB,WAAK,KAAK,MAAM,KAAK,GAAG,IAAI;AAAA,IAChC,OAAO;AACH,WAAK,KAAK,MAAM,KAAK,GAAI;AAAA,IAC7B;AACA,WAAO,OAAO,IAAI,OAAO,IAAI,EAAE,IAAI;AAAA,EACvC;AACJ;AAAA,CAEO,CAAUA,cAAV;AACI,MAAK;AAAL,IAAKC,YAAL;AACH,IAAAA,QAAA,aAAU;AACV,IAAAA,QAAA,aAAU;AACV,IAAAA,QAAA,aAAU;AACV,IAAAA,QAAA,aAAU;AAAA,KAJF,SAAAD,UAAA,WAAAA,UAAA;AAAA,GADC;",
  "names": ["Progress", "Status"]
}
